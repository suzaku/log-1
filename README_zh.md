# 中文文档・伪（暴论

## 钦点

按时间线来看，

glog 地位如同达摩祖师，开分级日志和高性能日志先河，衣钵（代码）和精神（接口）分别被 klog，grpclog，logr 继承，一代宗师高山仰止。

logrus 可比做大侠郭靖，资质平平（性能和易用度都不算上佳），但承上启下（上接标准库下开结构化），是里程碑式的人物。

zap 就厉害了，如同武当祖师张三丰，泰山北斗，玄门正宗（优步巨作）。九派十二支开枝散叶，各路好手（公司/团队）争相传颂。

zerolog 可比明教教主张无忌，名门之后（网飞首席），青出于蓝而胜于蓝（自述受 zap 启发），是当世绝顶高手（性能和接口皆为一时之选）。

## 缘起

李杜文章在，光焰万丈长。但是，为何还有各路英雄豪杰（尤其国人）前仆后继络绎不绝发明日志库呢？当真是蚍蜉撼大树，可笑不自量？  
作为一个资深的日志生产者和搬运工（大嘘），卡红心经过深入的观察和自身的心得体会，得出 go 主流日志库四大“罪”
  1. 没必要的依赖  
     目前主流的日志库或多或少都有第三方依赖，一部分是单元测试引入的，一部分是使用第三方终端库。前者可以回退到标准测试库实现，后者可以自己从头实现。我等只想记个日志而已，实在不值得 go get 时还引入了不必要的依赖。
  1. 欠佳彩色输出支持  
     由于开发者群体的关系，主流日志库比较关注 macOS 和 Linux 平台的彩色输出，Windows 平台（尤其是 Win7/Win8) 的支持欠佳。另外具体各项的色彩定制功能目前也是空白。
  1. 文件轮转和多分级文件的欠缺  
     日志轮转和多分级文件是常见的需求，目前主流日志库缺乏内置的支持，都需要借助 Hook 或第三方 Writer 实现，这造成了使用上的不便和额外的依赖。
  1. 繁琐的初始构造  
     由于上述种种，于是出现了一个奇特现象：我们只是想输出一条想要的日志，却在构造日志对象时候做了半天初始化的工作，就好像我只想累了睡觉，却不得不先跳半天健身操才能上床一样。  
     这又导致很多大手子就会常备一个类似 log 脚手架一样的函数或结构，美其名曰：适当定制以后再用。

*Enough is Enough*，于是我们见证到，持续以来，无数国人（确信）揭竿而起，斩木为兵。可惜质量参差不齐，功能缺斤少两，文档黑屁滚滚（自指确信）。卡红心忍耐生老练，老练生感召，于是也下场造了个轮子，

## 论剑

卡红心在推特上曾有大言：“一直以来，go 都缺少一个性能出众，功能完备，实现简单，接口易用，文档清晰，质量上乘的(结构化)日志库”，眼高如此，恣意妄评，想必这库必然有一些自持之处：
  1. 性能出众  
     很简单，作为一个新入场的日志库，即使功能和设计做的再好，也只会鲜有问津。 logrus/zap 珠玉在前，深入人心。和他们刚功能和设计，不太会有人买单。即使上一节我列举了这么多，But who cares?  
     那么唯有念咒：“千破万破，唯快不破”，说说容易，但是要比当世第一高手（正论）zerolog 性能还高，可不是一件容易的事情。  
     主要做了两件小事：一是重新实现 Logger 时候尽量手动内联，减少函数调用开销。二是手动格式化时间戳（可把我累坏了），去掉在跑分中占比最高的一个开销。  
     性能获得优势之后，颇有先声夺人之感，剩下的只是按照自己的想法来完善这个新生日志库了。
  1. 功能完备  
     如上节所说，此库自研了跨平台的彩色支持，文件轮转，多分级文件，系统日志，自定义模板，以及和第三方日志接口的互操作。  
     整整齐齐，大手子们来阅读代码时候我相信会有一种面面俱到的感觉哦。
  1. 实现简单  
     平坦胜于嵌套，以此为纲，此库没有出现类似自己引用自己的累赘之感，反而有一种一气呵成绝不拖泥带水的畅快，所有功能性代码写得非常直白，可谓唾手可得立等可取！这一点，恰恰是很多日志库忽视的。  
  1. 接口易用  
     经典的日志库设计，一般是三层结构，Logger -> Formatter/Encoder -> Writer，虽说这种设计是堂堂之阵正正之旗，但是作为用户，用起来不免困惑：“我想要的那个功能选项在哪一层？”  
     痛定思痛，此库挥泪斩 Formatter，硬生生去掉了中间的转换层。让日志库的使用，变得直观且无脑（迫真）！
  1. 文档清晰  
     作为一个严肃的日志库，清晰的文档必不可少。但是观察下来，即使是主流日志库也做的不算出色，大多在谈自己的优点、特色和动机。令人扼腕。  
     还好我在撰写 README 时候考量再三，基本把此库的接口和用法说清楚了，一直到忍到最后才得瑟了一下自己的性能。当然了，最后还是不能免俗，借这个文档暴论了一番。
  1. 质量上乘  
     自称质量上乘有两点，一是代码已经经过内部大手子的初步评审，普遍认为还行。二是测试覆盖率的话，看起来也不错（滑稽）。

总而言之，卡红心对此库颇为自得，对应上面各路宗师，常把它比作笑傲江湖的令狐冲。虽初入江湖，名不见经传，但是“以快打快”、“唯快不破”，假以时日，必然为日志届开一新气象。
不过同事涛哥不以为然，曾经点评道：“你这个顶多算是鸠摩智，到处偷学武功，但也似模象样。”，可谓一针见血，一转扎心！

## 破绽

前面吹嘘了这么多，这东西真的已然傲天吗？其实不然，自黑如下:
  1. FileWriter 的无锁化
  1. ConsoleWriter 记录解析的优化
  1. Context 的显式和隐式
  1. Logger 性能悖论

好吧，从头到脚都是破绽，但是这结束了么，并没有。 大家一起来比烂，观日志库于中国吧，

## 国人

（此处还在琢磨如何下笔，一言不慎可能会被橄榄）

## 未来

也许此库某种程度上已经到达了 go 语言的日志库边界，但是随着 go 语言的自身发展，让我来推演一下日志库会有什么样的未来吧，
